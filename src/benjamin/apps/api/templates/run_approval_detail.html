{% extends "base.html" %}
{% block content %}
<h2>Approval Detail</h2>
<p><strong>Approval ID:</strong> {{ record.id }}</p>
<p><strong>Status:</strong> {{ record.status }}</p>
<p>
  <strong>Correlation ID:</strong>
  {% if correlation_id %}
  <a href="/ui/correlation/{{ correlation_id }}">{{ correlation_id }}</a>
  {% else %}
  (none)
  {% endif %}
</p>
<p><strong>Idempotency Key:</strong> {{ idempotency_key }}</p>

<h3>Required Scopes</h3>
{% if record.required_scopes %}
<ul>
  {% for scope in record.required_scopes %}
  <li>{{ scope }} ({{ "enabled" if is_scope_enabled.get(scope) else "disabled" }})</li>
  {% endfor %}
</ul>
{% else %}
<p>None</p>
{% endif %}

<h3>Policy snapshots</h3>
<p><strong>At creation:</strong> <code>{{ record.policy_snapshot }}</code></p>
<p><strong>At approve attempt:</strong> <code>{{ record.policy_snapshot_at_approve }}</code></p>
<p>
  <strong>Diff summary:</strong>
  enabled added={{ policy_diff.enabled_added }},
  enabled removed={{ policy_diff.enabled_removed }},
  rules_allowlist_changed={{ policy_diff.rules_allowlist_changed }}
</p>

<h3>Ledger Timeline</h3>
{% if timeline %}
<ul>
  {% for item in timeline %}
  <li>{{ item.ts_iso }} — {{ item.status }} — {{ item.key }}</li>
  {% endfor %}
</ul>
{% else %}
<p>No ledger records found for this approval execution key.</p>
{% endif %}

<h3>Approval JSON</h3>
<pre>{{ record_json }}</pre>
{% endblock %}
